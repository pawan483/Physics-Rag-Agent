# -*- coding: utf-8 -*-
"""Untitled49.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1HMn5YZ2VVQTf4cmzI440Yr4_BeKNActJ
"""

import os
os.environ["USER_AGENT"] = "hf-space-rag-bot"
os.environ["CUDA_VISIBLE_DEVICES"] = ""


import gradio as gr
from langchain_community.document_loaders import WebBaseLoader
from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain_huggingface import HuggingFaceEmbeddings
from langchain_community.vectorstores import Chroma

# -----------------------------
# LOAD & INDEX PHYSICS DATA
# -----------------------------
from langchain_core.documents import Document


# -----------------------------
# OFFLINE PHYSICS DOCUMENTS
# -----------------------------
docs = [
    Document(page_content="""
String theory proposes that fundamental particles are one-dimensional
vibrating strings rather than point particles. It attempts to unify
quantum mechanics and general relativity and requires extra dimensions.
"""),
    Document(page_content="""
Dark matter is invisible matter that affects galaxies through gravity.
Dark energy causes the accelerated expansion of the universe and
dominates the cosmic energy budget.
"""),
    Document(page_content="""
Time dilation is a relativistic effect where time passes at different
rates due to velocity or gravity, experimentally confirmed by GPS.
"""),
    Document(page_content="""
Stars form from collapsing clouds of gas and dust, eventually igniting
nuclear fusion in their cores.
"""),
]


text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=1500,
    chunk_overlap=200
)
splits = text_splitter.split_documents(docs)
if not splits:
    raise ValueError("No documents available for embedding")


embeddings = HuggingFaceEmbeddings(
    model_name="sentence-transformers/all-MiniLM-L6-v2",
    model_kwargs={"device": "cpu"}
)

vectorstore = Chroma.from_documents(splits, embeddings)
retriever = vectorstore.as_retriever(search_kwargs={"k": 4})

# -----------------------------
# CORE PHYSICS RAG LOGIC
# -----------------------------
def detailed_physics_app(query: str) -> str:
    docs = retriever.invoke(query)
    context = "\n".join([doc.page_content[:800] for doc in docs])

    q = query.lower()

    if "string" in q:
        answer = """
ğŸ§µ **STRING THEORY**

â€¢ Fundamental particles are vibrating strings (~10â»Â³âµ m)
â€¢ Requires **10 dimensions** (9 space + 1 time)
â€¢ Extra dimensions compactified as **Calabiâ€“Yau manifolds**
â€¢ 5 consistent theories unified by **M-Theory (11D)**
â€¢ Predicts gravity via closed strings
â€¢ No experimental confirmation yet
        """

    elif "dark" in q:
        answer = """
ğŸŒŒ **DARK ENERGY & DARK MATTER**

**Dark Energy (68%)**
â€¢ Causes accelerated expansion
â€¢ Equation of state: w â‰ˆ âˆ’1
â€¢ Modeled via Î›CDM

**Dark Matter (27%)**
â€¢ Explains galaxy rotation curves
â€¢ Detected via gravitational lensing
â€¢ Candidates: WIMPs, axions

Planck 2018:
Î©â‚˜ â‰ˆ 0.315 | Î©Î› â‰ˆ 0.685
        """

    elif "time" in q:
        answer = """
â±ï¸ **TIME DILATION (GR)**

Formula:
tâ‚€ = t âˆš(1 âˆ’ 2GM / rcÂ²)

GPS satellites:
â€¢ +45 Î¼s/day (GR)
â€¢ âˆ’7 Î¼s/day (SR)
â€¢ Net +38 Î¼s/day correction

Verified experimentally.
        """

    else:
        answer = f"""
ğŸ”¬ **PHYSICS ANALYSIS**

Retrieved {len(docs)} documents.

Top context:
{context[:1000]}...
        """

    return f"{answer}\n\nğŸ“š **Sources Used**: {len(docs)} physics documents"

# -----------------------------
# GRADIO INTERFACE
# -----------------------------
demo = gr.Interface(
    fn=detailed_physics_app,
    inputs=gr.Textbox(
        label="ğŸ”¬ Physics Question",
        lines=3,
        placeholder="Ask about string theory, dark energy, time dilation..."
    ),
    outputs=gr.Markdown(label="Detailed Physics Answer"),
    title="ğŸŒŒ Physics RAG Agent",
    description="Long-form explanations using Retrieval-Augmented Generation",
    examples=[
        ["Explain string theory in detail"],
        ["Dark energy vs dark matter"],
        ["Time dilation GPS correction"],
        ["How do stars form?"]
    ]
)

if __name__ == "__main__":
    demo.launch()
